<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading... - Gusku.site</title>
    
    <link rel="preconnect" href="https://raw.githubusercontent.com">
    <link rel="dns-prefetch" href="https://raw.githubusercontent.com">

    <style>
        /* SINKRONISASI WARNA DARI INDEX.HTML */
        :root { --brand: #00d1b2; --dark: #1a1a1a; --light: #f4f4f4; }
        body { font-family: system-ui, -apple-system, sans-serif; line-height: 1.6; margin: 0; color: var(--dark); background: #fff; font-display: swap; }
        
        header { padding: 2rem 1rem; text-align: center; border-bottom: 1px solid #eee; background: linear-gradient(to bottom, #ffffff, #fafafa); }
        header h1 { margin: 0; font-size: 2.5rem; color: var(--brand); letter-spacing: -1px; }
        header h1 a { text-decoration: none; color: inherit; }
        nav { padding: 0.7rem; text-align: center; background: var(--dark); color: white; position: sticky; top: 0; z-index: 100; }
        nav a { color: white; text-decoration: none; font-weight: 500; font-size: 0.9rem; margin: 0 15px; }

        .container { max-width: 1000px; margin: 2rem auto; padding: 0 1rem; }

        /* HEADER IMAGE UKURAN SESUAI INSTRUKSI (KECIL) */
        .featured-img-container { text-align: center; margin-bottom: 2rem; }
        .featured-img { 
            width: 250px; /* Diperkecil agar proporsional */
            height: 140px; /* CLS fix: tinggi tetap */
            border-radius: 12px; 
            border: 3px solid var(--brand);
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }

        /* TABEL STYLIST & UNIK */
        .specs-table { 
            width: 100%; border-collapse: separate; border-spacing: 0; margin: 2rem 0; 
            border-radius: 12px; overflow: hidden; border: 1px solid #eee;
        }
        .specs-table tr:nth-child(even) { background-color: #fafafa; }
        .specs-table td { padding: 15px 20px; border-bottom: 1px solid #eee; font-size: 0.95rem; }
        .specs-table td:first-child { 
            width: 30%; font-weight: 700; color: var(--brand); 
            background: #fdfdfd; text-transform: uppercase; font-size: 0.75rem;
        }

        /* GRID REKOMENDASI (SINKRON INDEX) */
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-top: 2rem; }
        #recommendation-grid {
            min-height: 220px; /* CLS fix: reservasi ruang sebelum JS render */
        }
        .card { border: 1px solid #eee; border-radius: 10px; overflow: hidden; background: white; transition: all 0.3s ease; display: flex; flex-direction: column; }
        .card:hover { transform: translateY(-5px); border-color: var(--brand); }
        .card img { width: 100%; height: 100px; object-fit: cover; cursor: pointer; }
        .card-body { padding: 10px; flex-grow: 1; }
        .card-body h4 { font-size: 0.8rem; margin: 0 0 10px; height: 2.4rem; overflow: hidden; color: var(--dark); }
        .btn-small { background: var(--brand); color: white; text-align: center; padding: 6px; text-decoration: none; border-radius: 4px; font-size: 0.7rem; font-weight: 600; cursor: pointer; border: none; display: block; width: 100%; }

        footer { text-align: center; padding: 3rem 1rem; border-top: 1px solid #eee; margin-top: 4rem; background: #fafafa; color: #888; font-size: 0.8rem; }
        
        @media (max-width: 800px) { .grid { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>

<header><h1><a href="/">gusku.site</a></h1></header>
<nav><a href="/">Home</a></nav>

<div class="container" id="main-content">
    <p style="text-align:center">Finding game data...</p>
</div>

<div class="container">
    <h3 style="text-align:center; margin-top:3rem;">Recommended For You</h3>
    <div class="grid" id="recommendation-grid"></div>
</div>

<footer>&copy; 2026 gusku.site - Steam Video Game Dataset Explorer</footer>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const slug = urlParams.get('id'); 
    const githubRawBase = "https://raw.githubusercontent.com/dfgusss/gusku/main";

    // OPTIMASI LCP: Preload JSON jika f dan id sudah ada di URL
    const preloadFolder = urlParams.get('f');
    if (slug && preloadFolder) {
        const preLink = document.createElement('link');
        preLink.rel = 'preload';
        preLink.as = 'fetch';
        preLink.href = `${githubRawBase}/data/${preloadFolder}/${slug}.json`;
        preLink.crossOrigin = "anonymous";
        document.head.appendChild(preLink);
    }

    async function fetchGameData() {
        if (!slug) {
            document.getElementById('main-content').innerHTML = "No game selected.";
            return;
        }

        let folder = urlParams.get('f');

        try {
            // LOGIKA PENYELAMAT: Jika link Google lama (tidak ada &f=)
            if (!folder) {
                document.getElementById('main-content').innerHTML = "<p style='text-align:center'>Checking database...</p>";
                for (let i = 1; i <= 70; i++) {
                    const listRes = await fetch(`${githubRawBase}/lists/list_${i}.json`);
                    const listData = await listRes.json();
                    const match = listData.find(g => g.s === slug);
                    if (match) {
                        folder = match.f;
                        break; 
                    }
                }
            }

            if (!folder) throw new Error("Game not found in any shard");

            // Tembak langsung ke file detail
            const dataPath = `${githubRawBase}/data/${folder}/${slug}.json`;
            const dataRes = await fetch(dataPath);
            
            if (!dataRes.ok) throw new Error("Game file not found");
            
            const fullData = await dataRes.json();
            renderPage(fullData);

            // Rekomendasi
            const randomShard = Math.floor(Math.random() * 70) + 1;
            const listRes = await fetch(`${githubRawBase}/lists/list_${randomShard}.json`);
            const listData = await listRes.json();
            
            const adsterra = "https://www.effectivegatecpm.com/xjsgcgii37?key=606d2c74ae50bd149743d90c3719a164";
            const monetag = "https://otieu.com/4/8764643";
            
            renderRecommendations(adsterra, monetag, listData);

        } catch (error) {
            console.error(error);
            document.getElementById('main-content').innerHTML = "Error loading game details. This game might be missing from our records.";
        }
    }

    function renderPage(data) {
        document.title = `${data.Name} - Gusku.site`;
        document.getElementById('main-content').innerHTML = `
            <div class="featured-img-container">
                <img src="${data['Header image']}" 
                     class="featured-img" 
                     alt="Header image of ${data.Name}" 
                     width="250" 
                     height="140"
                     fetchpriority="high">
            </div>
            <table class="specs-table">
                <tr><td>Name</td><td><strong>${data.Name}</strong></td></tr>
                <tr><td>Release Date</td><td>${data['Release date'] || '-'}</td></tr>
                <tr><td>Price</td><td>${data.Price == 0 ? 'Free' : '$'+data.Price}</td></tr>
                <tr><td>Developer</td><td>${data.Developers || '-'}</td></tr>
                <tr><td>Publisher</td><td>${data.Publishers || '-'}</td></tr>
                <tr><td>About Game</td><td>${data['About the game'] || 'No description available.'}</td></tr>
            </table>
        `;
    }

   function renderRecommendations(adsterra, monetag, listData) {
    const grid = document.getElementById('recommendation-grid');
    const selected = listData.sort(() => 0.5 - Math.random()).slice(0, 5);

    grid.innerHTML = selected.map(g => {
        // MENGKECILKAN GAMBAR: Ganti header.jpg ke capsule_184x69.jpg
        // Ini akan menghemat bandwidth user dan menaikkan skor Performance
        const smallImg = g.i.replace('header.jpg', 'capsule_184x69.jpg');

        return `
            <div class="card">
                <img src="${smallImg}" 
                     alt="${g.n}" 
                     width="184" 
                     height="69" 
                     loading="lazy"
                     style="aspect-ratio: 184/69; object-fit: cover;"
                     onclick="window.open('${adsterra}', '_blank'); window.location.href='?id=${g.s}&f=${g.f}'">
                <div class="card-body">
                    <h4>${g.n}</h4>
                    <button class="btn-small" 
                            aria-label="View detail of ${g.n}"
                            onclick="window.open('${monetag}', '_blank'); window.location.href='?id=${g.s}&f=${g.f}'">
                        View Detail
                    </button>
                </div>
            </div>
        `;
    }).join('');
}

    fetchGameData();
</script>

</body>
</html>